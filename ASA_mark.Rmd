---
title: "ASA_mark"
author: "Loïc"
date: "2024-10-29"
output: html_document
---


Packages:
```{r}
library(GGally)
library(FactoMineR)
library(factoextra)
library(glmmTMB)
library(ggplot2)
```



Import et traitement des données:
```{r}
data = read.csv("data.csv", header = T)
data = data[,-1]
data[,1] = as.factor(data[,1])
data[,2] = as.factor(data[,2])
data[,3] = as.factor(data[,3])
```


Corrélations entre variables:
```{r}
data_cor = data[,4:13]
ggpairs(data_cor) 
```


Dotchart OTM avec couleur en fct du traitement
```{r}
classes = data$Treatment
couleurs = c("dodgerblue3", "firebrick", "darkorange", "forestgreen","pink")
couleurs_points = couleurs[classes]

dotchart(data$Olive_Tail_Moment, pch=16, col=couleurs_points, xlab="OTM")
legend("topright", legend=levels(classes), col=couleurs, pch=16)
```

GLMM avec distribution gamma zero inflated
```{r}
mod_zi_gamma <- glmmTMB(
  sqrt(Olive_Tail_Moment+1) ~ Treatment + (1 | ID/PIC), # OTM+1 pour éviter les négatifs, et effet aléatoire "photo" imbriqué dans "individu"
  family = ziGamma(link = "log"),  
  data = data
)


# Vérification des résidus
summary(mod_zi_gamma)
residuals <- residuals(mod_zi_gamma)
fitted_values <- fitted(mod_zi_gamma)
plot(fitted_values,residuals)

ggplot(data, aes(x = fitted_values, y = residuals, color = Treatment)) +
  geom_point(alpha = 0.6) +
  labs(x = "Valeurs Ajustées", y = "Résidus", color = "Traitement") +
  theme_minimal() +
  theme(legend.position = "right")
```